<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/GUIA_FEIGN_CLIENT.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/GUIA_FEIGN_CLIENT.md" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="# Guía: Cliente Feign entre Facturación y Tarifa&#10;&#10;## ✅ IMPLEMENTACIÓN COMPLETA&#10;&#10;### **Archivos creados:**&#10;&#10;1. **TarifaFeignClient.java** - `facturacion/src/main/java/grupo4/facturacion/client/`&#10;   - Interfaz que define los métodos para comunicarse con el microservicio de Tarifas&#10;   - Configurado con `@FeignClient(name = &quot;tarifas&quot;, url = &quot;http://localhost:8086&quot;)`&#10;&#10;2. **TarifaDTO.java** - `facturacion/src/main/java/grupo4/facturacion/dto/`&#10;   - DTO para recibir datos del microservicio de Tarifas&#10;&#10;### **Archivos modificados:**&#10;&#10;3. **FacturaService.java**&#10;   - Inyección del `TarifaFeignClient` con `@Autowired`&#10;   - Listo para usar en cualquier método del servicio&#10;&#10;##  CÓMO USAR EL FEIGN CLIENT&#10;&#10;El `TarifaFeignClient` está inyectado en `FacturaService` y listo para usar. Aquí tienes ejemplos:&#10;&#10;### **Ejemplo 1: Obtener tarifa por ID**&#10;```java&#10;@Transactional&#10;public Factura crearFacturaConTarifa(Long tarifaId, Factura factura) {&#10;    // Obtener tarifa desde el microservicio de Tarifas&#10;    TarifaDTO tarifa = tarifaFeignClient.findTarifaById(tarifaId).getBody();&#10;    &#10;    // Usar la tarifa para calcular el monto&#10;    if (tarifa != null) {&#10;        double montoTotal = tarifa.getMonto() + tarifa.getMontoExtra();&#10;        // ... lógica de negocio&#10;    }&#10;    &#10;    return facturaRepository.save(factura);&#10;}&#10;```&#10;&#10;### **Ejemplo 2: Obtener tarifa por fecha**&#10;```java&#10;@Transactional&#10;public double calcularMontoSegunFecha(Date fecha) {&#10;    TarifaDTO tarifa = tarifaFeignClient.findTarifaByFecha(fecha).getBody();&#10;    &#10;    if (tarifa != null) {&#10;        return tarifa.getMonto() + tarifa.getMontoExtra();&#10;    }&#10;    return 0.0;&#10;}&#10;```&#10;&#10;### **Ejemplo 3: Listar todas las tarifas**&#10;```java&#10;@Transactional(readOnly = true)&#10;public void procesarTodasLasTarifas() {&#10;    List&lt;TarifaDTO&gt; tarifas = tarifaFeignClient.findAllTarifas().getBody();&#10;    &#10;    if (tarifas != null) {&#10;        // Procesar las tarifas&#10;        tarifas.forEach(tarifa -&gt; {&#10;            // ... lógica de negocio&#10;        });&#10;    }&#10;}&#10;```&#10;&#10;##  MÉTODOS DISPONIBLES EN TarifaFeignClient&#10;&#10;```java&#10;// Obtener todas las tarifas&#10;ResponseEntity&lt;List&lt;TarifaDTO&gt;&gt; findAllTarifas()&#10;&#10;// Obtener tarifa por ID&#10;ResponseEntity&lt;TarifaDTO&gt; findTarifaById(Long id)&#10;&#10;// Obtener tarifa por fecha&#10;ResponseEntity&lt;TarifaDTO&gt; findTarifaByFecha(Date fecha)&#10;&#10;// Obtener tarifa por monto&#10;ResponseEntity&lt;TarifaDTO&gt; findTarifaByMonto(double monto)&#10;```&#10;&#10;##  PARA PROBAR&#10;&#10;1. **Iniciar MySQL** (puerto 3306) para el microservicio de Tarifas&#10;2. **Iniciar PostgreSQL** (puerto 5432) para el microservicio de Facturación&#10;3. **Iniciar microservicio Tarifas** (puerto 8086)&#10;4. **Iniciar microservicio Facturación** (puerto 8083)&#10;&#10;## ⚠️ IMPORTANTE&#10;&#10;- El `TarifaFeignClient` está inyectado en `FacturaService`, **NO** en el controlador&#10;- Usa el cliente dentro de tu lógica de negocio en los servicios&#10;- Ambos microservicios deben estar corriendo para que funcione&#10;- Siempre verifica que `.getBody()` no sea null antes de usarlo&#10;&#10;##  CONFIGURACIÓN&#10;&#10;**Microservicio de Tarifas:**&#10;- Puerto: 8086&#10;- Base de datos: MySQL (localhost:3306)&#10;- Nombre de DB: tarifas&#10;&#10;**Microservicio de Facturación:**&#10;- Puerto: 8083&#10;- Base de datos: PostgreSQL (localhost:5432)&#10;- Nombre de DB: facturas&#10;&#10;##  BUENAS PRÁCTICAS&#10;&#10;1. **Manejo de errores**: Siempre verifica si la respuesta es null&#10;   ```java&#10;   TarifaDTO tarifa = tarifaFeignClient.findTarifaById(id).getBody();&#10;   if (tarifa == null) {&#10;       throw new RuntimeException(&quot;Tarifa no encontrada&quot;);&#10;   }&#10;   ```&#10;&#10;2. **Timeouts**: Puedes configurar timeouts en el application.properties&#10;   ```properties&#10;   feign.client.config.tarifas.connectTimeout=5000&#10;   feign.client.config.tarifas.readTimeout=5000&#10;   ```&#10;&#10;3. **Logs**: Activa logs de Feign para debugging&#10;   ```properties&#10;   logging.level.grupo4.facturacion.client.TarifaFeignClient=DEBUG&#10;   ```&#10;&#10;## ✅ RESUMEN&#10;&#10;Tu implementación Feign está lista. Solo tienes que:&#10;1. Usar `tarifaFeignClient` dentro de tus métodos de `FacturaService`&#10;2. Llamar a los métodos disponibles según necesites&#10;3. Manejar las respuestas apropiadamente&#10;&#10;¡El cliente Feign se encarga automáticamente de hacer las llamadas HTTP al microservicio de Tarifas!" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/controller/FacturaController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/controller/FacturaController.java" />
              <option name="originalContent" value="package grupo4.facturacion.controller;&#10;&#10;import grupo4.facturacion.entity.Factura;&#10;import grupo4.facturacion.service.FacturaService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.format.annotation.DateTimeFormat;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.util.Date;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/facturas&quot;)&#10;public class FacturaController {&#10;&#10;    @Autowired&#10;    private FacturaService facturaService;&#10;&#10;    @GetMapping(&quot;/&quot;)&#10;    public ResponseEntity&lt;?&gt; findAll(){&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findAll());&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; findById(@PathVariable Long id) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findById(id));&#10;    }&#10;&#10;    @GetMapping(&quot;/usuario/id/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByUsuarioId(@PathVariable Long id) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByUsuarioId(id));&#10;    }&#10;&#10;    @PostMapping(&quot;&quot;)&#10;    public ResponseEntity&lt;?&gt; save(@RequestBody Factura factura) {&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(facturaService.save(factura));&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; delete(@PathVariable Long id) {&#10;        facturaService.delete(id);&#10;        return ResponseEntity.status(HttpStatus.NO_CONTENT).build();&#10;    }&#10;&#10;    @GetMapping(&quot;/usuario/name/{usuario}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByUsuario(@PathVariable String usuario) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByUsuario(usuario));&#10;    }&#10;&#10;    @GetMapping(&quot;/estado/{estado}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByEstado(@PathVariable String estado) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByEstado(estado));&#10;    }&#10;&#10;    @GetMapping(&quot;/fecha/{fecha}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByFecha(@PathVariable @DateTimeFormat(iso = DateTimeFormat.ISO.DATE) Date fecha) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByFecha(fecha));&#10;    }&#10;&#10;    @GetMapping(&quot;/fechaBetween&quot;)&#10;    public ResponseEntity&lt;?&gt;findByFechaBetween(@RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)Date fecha1,&#10;                                               @RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)Date fecha2) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByFechaBetween(fecha1, fecha2));&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package grupo4.facturacion.controller;&#10;&#10;import grupo4.facturacion.entity.Factura;&#10;import grupo4.facturacion.service.FacturaService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.format.annotation.DateTimeFormat;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;import java.util.Date;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/facturas&quot;)&#10;public class FacturaController {&#10;&#10;    @Autowired&#10;    private FacturaService facturaService;&#10;&#10;    @GetMapping(&quot;/&quot;)&#10;    public ResponseEntity&lt;?&gt; findAll(){&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findAll());&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; findById(@PathVariable Long id) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findById(id));&#10;    }&#10;&#10;    @GetMapping(&quot;/usuario/id/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByUsuarioId(@PathVariable Long id) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByUsuarioId(id));&#10;    }&#10;&#10;    @PostMapping(&quot;&quot;)&#10;    public ResponseEntity&lt;?&gt; save(@RequestBody Factura factura) {&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(facturaService.save(factura));&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; delete(@PathVariable Long id) {&#10;        facturaService.delete(id);&#10;        return ResponseEntity.status(HttpStatus.NO_CONTENT).build();&#10;    }&#10;&#10;    @GetMapping(&quot;/usuario/name/{usuario}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByUsuario(@PathVariable String usuario) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByUsuario(usuario));&#10;    }&#10;&#10;    @GetMapping(&quot;/estado/{estado}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByEstado(@PathVariable String estado) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByEstado(estado));&#10;    }&#10;&#10;    @GetMapping(&quot;/fecha/{fecha}&quot;)&#10;    public ResponseEntity&lt;?&gt; findByFecha(@PathVariable @DateTimeFormat(iso = DateTimeFormat.ISO.DATE) Date fecha) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByFecha(fecha));&#10;    }&#10;&#10;    @GetMapping(&quot;/fechaBetween&quot;)&#10;    public ResponseEntity&lt;?&gt;findByFechaBetween(@RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)Date fecha1,&#10;                                               @RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE)Date fecha2) {&#10;        return ResponseEntity.status(HttpStatus.OK).body(facturaService.findByFechaBetween(fecha1, fecha2));&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/dto/TarifaDTO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/dto/TarifaDTO.java" />
              <option name="updatedContent" value="package grupo4.facturacion.dto;&#10;&#10;import lombok.AllArgsConstructor;&#10;import lombok.Getter;&#10;import lombok.NoArgsConstructor;&#10;&#10;import java.util.Date;&#10;&#10;@NoArgsConstructor&#10;@AllArgsConstructor&#10;@Getter&#10;public class TarifaDTO {&#10;    private double monto;&#10;    private double montoExtra;&#10;    private Date date;&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;TarifaDTO [monto=&quot; + monto +&#10;                &quot;, montoExtra=&quot; + montoExtra +&#10;                &quot;, date=&quot; + date + &quot;]&quot;;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/service/FacturaService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/facturacion/src/main/java/grupo4/facturacion/service/FacturaService.java" />
              <option name="originalContent" value="package grupo4.facturacion.service;&#10;&#10;import grupo4.facturacion.entity.Factura;&#10;&#10;import grupo4.facturacion.repository.FacturaRepository;&#10;import grupo4.mscvadmin.services.UsuarioService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import org.springframework.web.client.RestTemplate;&#10;&#10;import java.util.Date;&#10;import java.util.List;&#10;&#10;@Service&#10;public class FacturaService {&#10;&#10;    @Autowired&#10;    private FacturaRepository facturaRepository;&#10;&#10;    @Transactional(readOnly = true)&#10;    public List&lt;Factura&gt; findAll(){&#10;        return facturaRepository.findAll();&#10;    }&#10;&#10;    @Transactional(readOnly = true)&#10;    public Factura findById(Long id){&#10;        return facturaRepository.findById(id).orElse(null);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByUsuarioId(Long id){&#10;        return facturaRepository.findByUsuarioId(id);&#10;    }&#10;&#10;&#10;    @Transactional&#10;    public Factura save(Factura factura){&#10;        return facturaRepository.save(factura);&#10;    }&#10;&#10;    @Transactional&#10;    public void delete(Long id){&#10;        facturaRepository.deleteById(id);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByUsuario(String usuario) {&#10;        return facturaRepository.findByUsuario(usuario);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByEstado(String estado){&#10;        return facturaRepository.findByEstado(estado);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByFecha(Date fecha){&#10;        return facturaRepository.findByFecha(fecha);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByFechaBetween(Date fecha1, Date fecha2){&#10;        return facturaRepository.findByFechaBetween(fecha1,fecha2);&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package grupo4.facturacion.service;&#10;&#10;import grupo4.facturacion.client.TarifaFeignClient;&#10;import grupo4.facturacion.entity.Factura;&#10;&#10;import grupo4.facturacion.repository.FacturaRepository;&#10;import grupo4.mscvadmin.services.UsuarioService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import org.springframework.web.client.RestTemplate;&#10;&#10;import java.util.Date;&#10;import java.util.List;&#10;&#10;@Service&#10;public class FacturaService {&#10;&#10;    @Autowired&#10;    private FacturaRepository facturaRepository;&#10;&#10;    @Autowired&#10;    private TarifaFeignClient tarifaFeignClient;&#10;&#10;    @Transactional(readOnly = true)&#10;    public List&lt;Factura&gt; findAll(){&#10;        return facturaRepository.findAll();&#10;    }&#10;&#10;    @Transactional(readOnly = true)&#10;    public Factura findById(Long id){&#10;        return facturaRepository.findById(id).orElse(null);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByUsuarioId(Long id){&#10;        return facturaRepository.findByUsuarioId(id);&#10;    }&#10;&#10;&#10;    @Transactional&#10;    public Factura save(Factura factura){&#10;        return facturaRepository.save(factura);&#10;    }&#10;&#10;    @Transactional&#10;    public void delete(Long id){&#10;        facturaRepository.deleteById(id);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByUsuario(String usuario) {&#10;        return facturaRepository.findByUsuario(usuario);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByEstado(String estado){&#10;        return facturaRepository.findByEstado(estado);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByFecha(Date fecha){&#10;        return facturaRepository.findByFecha(fecha);&#10;    }&#10;&#10;    @Transactional&#10;    public List&lt;Factura&gt; findByFechaBetween(Date fecha1, Date fecha2){&#10;        return facturaRepository.findByFechaBetween(fecha1,fecha2);&#10;    }&#10;&#10;    // Aquí puedes usar tarifaFeignClient cuando necesites consultar tarifas&#10;    // Ejemplo: TarifaDTO tarifa = tarifaFeignClient.findTarifaById(id).getBody();&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>